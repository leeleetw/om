
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>counter</title>
  <style>
    :root {
      --bg: #f2f6f8;
      --primary: #5a90b8;
      --text: #fff;
      --muted: #6a7b8a;
      --card: #ffffff;
      --today: #dcefff;
    }

    * {
      box-sizing: border-box;
    }

    body, html {
      margin: 0;
      padding: 0;
      background: var(--bg);
      font-family: "Helvetica Neue", sans-serif;
    }

    .counter-screen .tap-area {
      height: calc(100vh - 10px);
      margin: 5px;
      border-radius: 24px;
      background: var(--primary);
   color: #dde6ee;

      font-size: 30vw;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      user-select: none;
      transition: background 0.3s;
    }

    .calendar-screen {
      display: none;
      padding: 16px;
      background: var(--card);
      border-top: 2px solid #ccc;
      border-radius: 16px 16px 0 0;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
	    /* 加上這兩行來對齊 tap-area 的寬度與 margin */
  margin: 5px;
  border-radius: 24px;
	  
    }

    .calendar-screen.active {
      display: block;
    }

    .calendar-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
    }

    .calendar-header .month-nav {
      display: flex;
      align-items: center;
      gap: 16px;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .calendar-header .month-nav button {
      font-size: 1.2rem;
      padding: 6px 10px;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 8px;
    }

    .weekday {
      text-align: center;
      font-weight: bold;
      color: var(--muted);
    }

    .day {
      height: 50px;
      background: #f0f0f0;
      border-radius: 10px;
      font-size: 0.8rem;
      text-align: center;
      padding-top: 4px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
    }

    .day .info {
      font-size: 0.7rem;
      color: #999;
    }

    .today {
      background: var(--today);
      font-weight: bold;
      border: 2px solid var(--primary);
    }

/* 修改按鈕樣式，強制顏色一致 */
.circle-btn {
  position: fixed;
  top: 10px;
  background: #6b8797;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  font-size: 1.2rem;
  border: none;
  color: black !important;
  -webkit-text-fill-color: black !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  overflow: hidden;
}


/* 如果需要，可以替換Emoji為SVG或自定義字體圖標 */

    .toggle-calendar-btn { right: 110px; }
    .reset-btn { right: 160px;
  touch-action: manipulation; /* ✅ 新增這一行，避免雙擊縮放 */
	}
    .play-btn { right: 10px; }
    .speed-btn { right: 60px; font-size: 0.9rem; }

    .monthly-box {
      display: inline-block;
      margin-top: 6px;
      padding: 4px 10px;
      border-radius: 12px;
      background: #f5a623;
      font-weight: bold;
      color: #333;
    }
    
    .date-update-toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9rem;
      z-index: 2000;
      animation: fadeInOut 3s forwards;
      opacity: 0;
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }
	
.circle-btn img.icon {
  width: 60%;
  height: 60%;
  object-fit: contain;
  display: block;
  margin: auto;
}



  </style>
</head>
<body>
  <!-- 控制按鈕 -->
<button class="circle-btn play-btn" onclick="togglePlay()">
  <img src="playpause.png" alt="播放暫停" class="icon" />
</button>

<button class="circle-btn speed-btn" onclick="toggleSpeed()">1x</button>

<button class="circle-btn reset-btn">
  <img src="reset.png" alt="歸零" class="icon" />
</button>

<button class="circle-btn toggle-calendar-btn" onclick="toggleCalendar()">
  <img src="calendar.png" alt="月曆" class="icon" />
</button>



  <!-- 計數器 + 月曆區塊 -->
  <div id="counterScreen" class="counter-screen">
    <div class="tap-area" id="tapArea">0 / 0</div>
    <div id="calendarScreen" class="calendar-screen">
      <div class="calendar-header">
        <div class="month-nav">
          <button onclick="changeMonth(-1)">←</button>
          <span id="monthLabel"></span>
          <button onclick="changeMonth(1)">→</button>
        </div>
      </div>
      <div class="calendar-grid" id="calendarWeekdays"></div>
      <div class="calendar-grid" id="calendarDays"></div>
      <div style="margin-top:8px;font-weight:bold;">本月組數：
        <div class="monthly-box"><span id="monthlyTotal">0</span></div>
      </div>
    </div>
  </div>

  <audio id="bgm" loop>
    <source src="background.mp3" type="audio/mpeg">
  </audio>

  <script>
    const countEl = document.getElementById('tapArea');
    const calendarScreen = document.getElementById('calendarScreen');
    const calendarDaysEl = document.getElementById('calendarDays');
    const calendarWeekdaysEl = document.getElementById('calendarWeekdays');
    const monthLabelEl = document.getElementById('monthLabel');
    const monthlyTotalEl = document.getElementById('monthlyTotal');
    const audio = document.getElementById('bgm');
    const speedBtn = document.querySelector('.speed-btn');
    const calendarBtn = document.querySelector('.toggle-calendar-btn');
    const resetBtn = document.querySelector('.reset-btn');

    // 日期相關變數
    let today = new Date();
    let todayKey = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;

    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    let currentSpeed = 1;

    let monthData = JSON.parse(localStorage.getItem('monthData')) || {};
    let count = parseInt(localStorage.getItem('count')) || 0;
    let group = parseInt(localStorage.getItem('group')) || 0;

    // 自動檢查日期更新
    function checkDateUpdate() {
      const newDate = new Date();
      const newDateKey = `${newDate.getFullYear()}-${newDate.getMonth() + 1}-${newDate.getDate()}`;
      
      if (newDateKey !== todayKey) {
        // 顯示日期變更通知
        showDateUpdateToast();
        
        // 更新日期相關變數
        today = newDate;
        todayKey = newDateKey;
        currentYear = today.getFullYear();
        currentMonth = today.getMonth();
        
        // 如果月曆是開啟的，更新月曆視圖
        if (calendarScreen.classList.contains('active')) {
          renderCalendar(currentYear, currentMonth);
        }
      }
    }
    
    // 顯示日期更新提示
    function showDateUpdateToast() {
      const toast = document.createElement('div');
      toast.className = 'date-update-toast';
      toast.textContent = '日期已更新至今天';
      document.body.appendChild(toast);
      
      // 3秒後自動移除提示
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }
    
    // 設置定時檢查，每分鐘檢查一次日期
    setInterval(checkDateUpdate, 60000);
    
    // 額外檢查：設置定時在每天午夜12:00:10檢查
    function setMidnightCheck() {
      const now = new Date();
      const tomorrow = new Date(now);
      tomorrow.setDate(tomorrow.getDate() + 1);
      tomorrow.setHours(0, 0, 10, 0); // 設為午夜後10秒，確保日期已經完全變更
      
      const timeToMidnight = tomorrow - now;
      
      // 設置午夜檢查
      setTimeout(() => {
        checkDateUpdate();
        // 設置下一天的檢查
        setMidnightCheck();
      }, timeToMidnight);
    }
    
    // 初始化午夜檢查
    setMidnightCheck();

    function save() {
      localStorage.setItem('count', count);
      localStorage.setItem('group', group);
      monthData[todayKey] = { count, group };
      localStorage.setItem('monthData', JSON.stringify(monthData));
      if (calendarScreen.classList.contains('active')) {
        renderCalendar(currentYear, currentMonth);
      }
    }

    function updateCounterDisplay() {
      countEl.textContent = `${count} / ${group}`;
    }

    function incrementCounter() {
      count++;
      if (count >= 108) {
        count = 0;
        group++;
      }
      updateCounterDisplay();
      save();
    }


    countEl.addEventListener('mouseup', () => {
      clearTimeout(pressTimer);
    });

    countEl.addEventListener('click', () => {
      incrementCounter();
    });

 // ✅ 新增這段，長按 resetBtn 1.2 秒才會歸零 count
let pressTimer;
// 手機
resetBtn.addEventListener('touchstart', () => {
  pressTimer = setTimeout(() => {
    count = 0;
    updateCounterDisplay();
    save();
    showResetToast();
  }, 1200);
});
resetBtn.addEventListener('touchend', () => {
  clearTimeout(pressTimer);
});

// 電腦
resetBtn.addEventListener('mousedown', () => {
  pressTimer = setTimeout(() => {
    count = 0;
    updateCounterDisplay();
    save();
    showResetToast();
  }, 1200);
});
resetBtn.addEventListener('mouseup', () => {
  clearTimeout(pressTimer);
});



function toggleCalendar() {
  const visible = calendarScreen.classList.toggle('active');
  const icon = calendarBtn.querySelector('img');

  if (visible) {
    icon.src = 'back.png';
    icon.alt = '返回';
    // ✅ 不再限制 overflow，讓捲動條可以自然出現
  } else {
    icon.src = 'calendar.png';
    icon.alt = '月曆';
  }

  if (visible) renderCalendar(currentYear, currentMonth);
}





    function getDaysInMonth(year, month) {
      return new Date(year, month + 1, 0).getDate();
    }

    function renderCalendar(year, month) {
      calendarDaysEl.innerHTML = '';
      calendarWeekdaysEl.innerHTML = '';
      const weekdays = ['一', '二', '三', '四', '五', '六', '日'];
      weekdays.forEach(day => {
        const el = document.createElement('div');
        el.className = 'weekday';
        el.textContent = day;
        calendarWeekdaysEl.appendChild(el);
      });

      const days = getDaysInMonth(year, month);
      const firstDay = new Date(year, month, 1).getDay();
      const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
      let monthlyTotal = 0;
      for (let i = 0; i < adjustedFirstDay; i++) {
        calendarDaysEl.appendChild(document.createElement('div'));
      }
      for (let i = 1; i <= days; i++) {
        const key = `${year}-${month + 1}-${i}`;
        const d = document.createElement('div');
        d.className = 'day';
        if (key === todayKey) d.classList.add('today');
        const data = monthData[key] || { count: 0, group: 0 };
        d.innerHTML = `${i}<div class="info">${data.count}/${data.group}</div>`;
        calendarDaysEl.appendChild(d);
        monthlyTotal += data.group;
      }
      monthLabelEl.textContent = `${year} 年 ${month + 1} 月`;
      monthlyTotalEl.textContent = monthlyTotal;
    }

    function changeMonth(offset) {
      currentMonth += offset;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar(currentYear, currentMonth);
    }

function resetData() {
  count = 0; // ✅ 只歸零 count
  updateCounterDisplay();
  save();
}

    function togglePlay() {
      if (audio.paused) {
        audio.play();
        document.querySelector('.play-btn').textContent = '❚❚';
      } else {
        audio.pause();
        document.querySelector('.play-btn').textContent = '▶';
      }
    }

function toggleSpeed() {
  if (currentSpeed === 1) {
    currentSpeed = 1.5;
  } else if (currentSpeed === 1.5) {
    currentSpeed = 2;
  } else if (currentSpeed === 2) {
    currentSpeed = 2.5;
  } else {
    currentSpeed = 1;
  }

  audio.playbackRate = currentSpeed;
  speedBtn.textContent = currentSpeed + 'x';
}


    updateCounterDisplay();
    
countEl.addEventListener('touchend', (e) => {
  e.preventDefault();
  incrementCounter();
});

  </script>
</body>
</html>