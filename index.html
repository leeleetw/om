<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>counter</title>
  <style>
    :root {
      --bg: #f2f6f8;
      --primary: #5a90b8;
      --text: #fff;
      --muted: #6a7b8a;
      --card: #ffffff;
      --today: #dcefff;
    }

    * { box-sizing: border-box; }

    body, html {
      margin: 0;
      padding: 0;
      background: var(--bg);
      font-family: "Helvetica Neue", sans-serif;
    }

.icon-bg {
  width: 60%;
  height: 60%;
  background-image: url('reset.png');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}



    .counter-screen .tap-area {
      height: calc(100vh - 10px);
      margin: 5px;
      border-radius: 24px;
      background: var(--primary);
      color: #dde6ee;
      font-size: 30vw;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      user-select: none;
      transition: background 0.3s;
      touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

    .calendar-screen {
      display: none;
      padding: 16px;
      background: var(--card);
      border-top: 2px solid #ccc;
      border-radius: 24px;
      margin: 5px;
    }

    .calendar-screen.active { display: block; }

    .calendar-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
    }

    .calendar-header .month-nav {
      display: flex;
      align-items: center;
      gap: 16px;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .calendar-header .month-nav button {
      font-size: 1.2rem;
      padding: 6px 10px;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 8px;
    }

    .weekday {
      text-align: center;
      font-weight: bold;
      color: var(--muted);
    }

    .day {
      height: 50px;
      background: #f0f0f0;
      border-radius: 10px;
      font-size: 0.8rem;
      text-align: center;
      padding-top: 4px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
    }

    .day .info { font-size: 0.7rem; color: #999; }
    .today { background: var(--today); font-weight: bold; border: 2px solid var(--primary); }
    .group-only .info, .group-only {
      font-size: 1rem;
      font-weight: bold;
      color: #f5a623;
    }

    .circle-btn {
      position: fixed;
      top: 10px;
      background: #6b8797;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-size: 1.2rem;
      border: none;
      color: black !important;
      -webkit-text-fill-color: black !important;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      overflow: hidden;
    }

    .toggle-calendar-btn { right: 110px; }
    .reset-btn { right: 160px; touch-action: manipulation; }
    .play-btn { right: 10px; }
    .speed-btn { right: 60px; font-size: 0.9rem; }

    .monthly-box {
      display: inline-block;
      margin-top: 6px;
      padding: 4px 10px;
      border-radius: 12px;
      background: #f5a623;
      font-weight: bold;
      color: #333;
    }

.date-update-toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 0.9rem;
  z-index: 2000;
  opacity: 0;
  animation-fill-mode: forwards;
}




@keyframes fadeInOutDynamic {
  0% { opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { opacity: 0; }
}


    .circle-btn img.icon {
      width: 60%;
      height: 60%;
      object-fit: contain;
      display: block;
      margin: auto;
    }
  </style>
</head>
<body>
  <!-- ÊéßÂà∂ÊåâÈàï -->
  <button class="circle-btn play-btn" onclick="togglePlay()">
    <img src="playpause.png" alt="Êí≠ÊîæÊö´ÂÅú" class="icon" />
  </button>
  <button class="circle-btn speed-btn" onclick="toggleSpeed()">1x</button>
<button class="circle-btn reset-btn">
<div class="icon-bg"
     draggable="false"
     oncontextmenu="return false"
     ontouchstart="event.preventDefault()"
     style="user-select: none; -webkit-user-drag: none;"></div>

</button>

  <button class="circle-btn toggle-calendar-btn" onclick="toggleCalendar()">
    <img src="calendar.png" alt="ÊúàÊõÜ" class="icon" />
  </button>

  <!-- Ë®àÊï∏Âô® + ÊúàÊõÜÂçÄÂ°ä -->
  <div id="counterScreen" class="counter-screen">
    <div class="tap-area" id="tapArea">0 / 0</div>
    <div id="calendarScreen" class="calendar-screen">
      <div class="calendar-header">
        <div class="month-nav">
          <button onclick="changeMonth(-1)">‚Üê</button>
          <span id="monthLabel"></span>
          <button onclick="changeMonth(1)">‚Üí</button>
        </div>
      </div>
      <div class="calendar-grid" id="calendarWeekdays"></div>
      <div class="calendar-grid" id="calendarDays"></div>
      <div style="margin-top:8px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap: wrap;">
  <div>Êú¨ÊúàÁµÑÊï∏Ôºö<div class="monthly-box"><span id="monthlyTotal">0</span></div></div>
  <div style="display:flex; gap:8px;">
    <button onclick="exportData()" style="padding:4px 12px; border:none; border-radius:8px; background:#5a90b8; color:white; font-weight:bold;">ÂÇô‰ªΩ</button>
    <button onclick="importData()" style="padding:4px 12px; border:none; border-radius:8px; background:#5a90b8; color:white; font-weight:bold;">ÈÇÑÂéü</button>
  </div>
</div>
<textarea id="importArea" placeholder="Ë≤º‰∏äÂÇô‰ªΩË≥áÊñôÂæåÔºåÊåâ„ÄåÈÇÑÂéü„ÄçÈçµ" style="width:100%;height:80px;margin-top:6px;display:none;resize:none;"></textarea>
    </div>
  </div>
  <audio id="bgm" loop>
    <source src="background.mp3" type="audio/mpeg">
  </audio>
  <script>
  const countEl = document.getElementById('tapArea');
  const calendarScreen = document.getElementById('calendarScreen');
  const calendarDaysEl = document.getElementById('calendarDays');
  const calendarWeekdaysEl = document.getElementById('calendarWeekdays');
  const monthLabelEl = document.getElementById('monthLabel');
  const monthlyTotalEl = document.getElementById('monthlyTotal');
  const audio = document.getElementById('bgm');
  const speedBtn = document.querySelector('.speed-btn');
  const calendarBtn = document.querySelector('.toggle-calendar-btn');
  const resetBtn = document.querySelector('.reset-btn');

  let today = new Date();
  let todayKey = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
  let currentYear = today.getFullYear();
  let currentMonth = today.getMonth();
  let currentSpeed = 1;

  let monthData = JSON.parse(localStorage.getItem('monthData')) || {};
  let count = parseInt(localStorage.getItem('count')) || 0;
  let group = parseInt(localStorage.getItem('group')) || 0;



function showFloatingToast(message, duration = 5000) {
  const toast = document.createElement('div');
  toast.className = 'date-update-toast';
toast.innerHTML = message;


  // ÂãïÊÖãÊåáÂÆöÂãïÁï´Èï∑Â∫¶
  toast.style.animation = `fadeInOutDynamic ${duration / 1000}s forwards`;

  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), duration);
}


function checkDateUpdate() {
  const newDate = new Date();
  const newKey = `${newDate.getFullYear()}-${newDate.getMonth() + 1}-${newDate.getDate()}`;
  if (newKey !== todayKey) {
    monthData[todayKey] = { group };
    localStorage.setItem('monthData', JSON.stringify(monthData));
    today = newDate;
    todayKey = newKey;
    currentYear = today.getFullYear();
    currentMonth = today.getMonth();
    group = 0;
    updateCounterDisplay();

    showFloatingToast('Êó•ÊúüÂ∑≤Êõ¥Êñ∞Ëá≥‰ªäÂ§©', 3000); // ‚úÖ Êõø‰ª£ËàäÁöÑÂáΩÂºè
    save();
    if (calendarScreen.classList.contains('active')) renderCalendar(currentYear, currentMonth);
  }
}


  setInterval(checkDateUpdate, 60000);
  function setMidnightCheck() {
    const now = new Date();
    const t = new Date(now);
    t.setDate(t.getDate() + 1);
    t.setHours(0, 0, 10, 0);
    const delay = t - now;
    setTimeout(() => {
      checkDateUpdate();
      setMidnightCheck();
    }, delay);
  }
  setMidnightCheck();

  function save() {
    localStorage.setItem('count', count);
    localStorage.setItem('group', group);
    monthData[todayKey] = { count, group };
    localStorage.setItem('monthData', JSON.stringify(monthData));
    if (calendarScreen.classList.contains('active')) renderCalendar(currentYear, currentMonth);
  }

  function updateCounterDisplay() {
    countEl.textContent = `${count} / ${group}`;
  }

  function incrementCounter() {
    count++;
    if (count >= 108) {
      count = 0;
      group++;
    }
    updateCounterDisplay();
    save();
  }
// üìå Êõ¥Âø´ÁöÑÈªûÊìäÈüøÊáâÔºöÁî® pointerdown Êõø‰ª£ touchstart
const tapArea = document.getElementById('tapArea');

tapArea.addEventListener('pointerdown', (e) => {
  incrementCounter();
});


  let pressTimer;
resetBtn.addEventListener('pointerdown', () => {
  pressTimer = setTimeout(() => {
    count = 0;
    updateCounterDisplay();
    save();
    showFloatingToast('Â∑≤Ê≠∏Èõ∂Ë®àÊï∏', 3000);
  }, 1200);
});






    
  resetBtn.addEventListener('pointerup', () => {
    clearTimeout(pressTimer);
  });

  function toggleCalendar() {
    const visible = calendarScreen.classList.toggle('active');
    const icon = calendarBtn.querySelector('img');
    icon.src = visible ? 'back.png' : 'calendar.png';
    icon.alt = visible ? 'ËøîÂõû' : 'ÊúàÊõÜ';
    if (visible) renderCalendar(currentYear, currentMonth);
  }

  function getDaysInMonth(y, m) {
    return new Date(y, m + 1, 0).getDate();
  }

  function renderCalendar(y, m) {
    calendarDaysEl.innerHTML = '';
    calendarWeekdaysEl.innerHTML = '';
    ['‰∏Ä','‰∫å','‰∏â','Âõõ','‰∫î','ÂÖ≠','Êó•'].forEach(d => {
      const el = document.createElement('div');
      el.className = 'weekday';
      el.textContent = d;
      calendarWeekdaysEl.appendChild(el);
    });

    const days = getDaysInMonth(y, m);
    const firstDay = new Date(y, m, 1).getDay();
    const offset = firstDay === 0 ? 6 : firstDay - 1;
    let total = 0;
    for (let i = 0; i < offset; i++) calendarDaysEl.appendChild(document.createElement('div'));

    for (let i = 1; i <= days; i++) {
      const key = `${y}-${m + 1}-${i}`;
      const d = document.createElement('div');
      d.className = 'day';
      const dateObj = new Date(y, m, i);
      const isToday = key === todayKey;
      const isFuture = dateObj > new Date();
      const isPast = !isToday && !isFuture;
      const data = monthData[key];
      let infoHTML = '';

      if (isToday) {
        d.classList.add('today');
        infoHTML = `${count}/${group}`;
        total += group;
      } else if (isPast) {
        const g = data?.group || 0;
        if (g > 0) infoHTML = `<span class="group-only">${g}</span>`;
        total += g;
      } else {
        const c = data?.count ?? 0;
        const g = data?.group ?? 0;
        infoHTML = `${c}/${g}`;
      }
      d.innerHTML = `${i}<div class="info">${infoHTML}</div>`;
      calendarDaysEl.appendChild(d);
    }
    monthLabelEl.textContent = `${y} Âπ¥ ${m + 1} Êúà`;
    monthlyTotalEl.textContent = total;
  }

  function changeMonth(offset) {
    currentMonth += offset;
    if (currentMonth < 0) {
      currentMonth = 11;
      currentYear--;
    } else if (currentMonth > 11) {
      currentMonth = 0;
      currentYear++;
    }
    renderCalendar(currentYear, currentMonth);
  }

  function togglePlay() {
    if (audio.paused) audio.play();
    else audio.pause();
  }

  function toggleSpeed() {
    if (currentSpeed === 1) currentSpeed = 1.5;
    else if (currentSpeed === 1.5) currentSpeed = 2;
    else if (currentSpeed === 2) currentSpeed = 2.5;
    else if (currentSpeed === 2.5) currentSpeed = 3;
    else currentSpeed = 1;
    audio.playbackRate = currentSpeed;
    speedBtn.textContent = currentSpeed + 'x';
  }

function exportData() {
  const allData = {
    count,
    group,
    monthData
  };
  const json = JSON.stringify(allData);
  navigator.clipboard.writeText(json).then(() => {
    showFloatingToast('‚úÖ Ë≥áÊñôÂ∑≤Ë§áË£Ω<br>ÈñãÂïü GmailÔºåË≤º‰∏äÂÖßÂÆπ‰∏¶ÂØÑÁµ¶Ëá™Â∑±ÂÅöÂÇô‰ªΩ', 10000)  });//10Áßí
}



  function importData() {
    const textarea = document.getElementById('importArea');
    if (textarea.style.display === 'none') {
      textarea.style.display = 'block';
      textarea.focus();
      return;
    }
    const input = document.getElementById('importArea').value;
    try {
      const parsed = JSON.parse(input);
      count = parsed.count || 0;
      group = parsed.group || 0;
      monthData = parsed.monthData || {};
      save();
      updateCounterDisplay();
      showFloatingToast('‚úÖ ÈÇÑÂéüÊàêÂäü', 5000);//5Áßí
    } catch {
      showFloatingToast('‚ö†Ô∏è Ê†ºÂºèÈåØË™§ÔºåË´ãÁ¢∫Ë™çË≤º‰∏äÁöÑË≥áÊñô', 5000);//5Áßí
    }
  }

  updateCounterDisplay();
</script>
</body>
</html>

