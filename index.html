<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>計數與音檔月曆</title>
  <style>
    :root { --primary: #4a90e2; --secondary: #50e3c2; --bg: #f7f9fc; --card-bg: #ffffff; --text: #333; --muted: #888; --accent: #f5a623; --shadow: rgba(0,0,0,0.1); }
    * { margin:0; padding:0; box-sizing:border-box; }
    body,html { width:100%; min-height:100vh; font-family:'Helvetica Neue',Arial,sans-serif; background:var(--bg); color:var(--text); }
    .container { width:100%; max-width:600px; margin:auto; padding:1rem; }
    .card { position:relative; background:var(--card-bg); border-radius:8px; box-shadow:0 2px 8px var(--shadow); padding:1rem; margin-bottom:1rem; }

    /* 計數按鈕更大、更易點擊並置中數字 */
    #counterBtn {
      display:flex;
      align-items:center;
      justify-content:center;
      width:80vw;
      max-width:300px;
      height:80vw;
      max-height:300px;
      font-size:3rem;
      border:none;
      border-radius:50%;
      background:var(--primary);
      color:#fff;
      cursor:pointer;
      box-shadow:0 2px 4px var(--shadow);
      transition:transform 0.05s;
      margin:0.5rem auto;
    }
    #counterBtn:active { transform:scale(0.9); }

    .info { text-align:center; margin-top:0.5rem; }
    .info div { margin:0.25rem 0; }

    /* 日曆隱藏/顯示 */
    #toggleCalendarBtn {
      display:block;
      width:100%;
      padding:0.5rem;
      font-size:1rem;
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:4px;
      cursor:pointer;
      margin-bottom:1rem;
    }
    .calendar-container.hidden { display:none; }

    .calendar-container { position:relative; margin-top:1rem; }
    .calendar-header { display:flex; align-items:center; justify-content:center; position:relative; margin-bottom:0.5rem; }
    .nav-btn { background:none; border:none; font-size:1.5rem; cursor:pointer; color:var(--muted); padding:0 0.5rem; }
    #monthDisplay { font-weight:600; font-size:1.1rem; }
    #monthStats { position:absolute; right:0; font-size:0.9rem; color:var(--accent); }
    table.calendar { width:100%; border-collapse:collapse; background:var(--card-bg); border-radius:8px; overflow:hidden; }
    .calendar th, .calendar td { width:calc(100%/7); padding:0.5rem; text-align:center; font-size:0.85rem; border:1px solid #ececec; }
    .calendar th { background:var(--bg); color:var(--muted); }
    .today { background:var(--secondary); color:#fff; }
    .counts { font-size:0.7rem; color:var(--muted); margin-top:0.2rem; }

    /* 更隱形的播放控制台 */
    .audio-widget {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(0, 0, 0, 0.15);
      padding: 0.2rem;
      border-radius: 4px;
      transform: scale(0.7);
      transform-origin: top right;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      transition: background 0.2s;
    }
    .audio-widget:hover { background: rgba(0,0,0,0.3); }
    .audio-widget button { background: transparent; border: none; padding: 0; cursor: pointer; }
    .audio-widget svg { width: 1rem; height: 1rem; fill: #fff; }
    .audio-widget select { display: none; background: rgba(255,255,255,0.2); border: none; color: #fff; font-size: 0.7rem; padding: 0.15rem; border-radius: 3px; }
    .audio-widget:hover select { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <button id="counterBtn">0</button>
      <div class="info">
        <div id="groupDisplay">組數: 0</div>
        <div id="dailyDisplay">今日：0 / 108，組數：0</div>
      </div>

      <!-- 背景音樂 Widget -->
      <div class="audio-widget">
        <button id="playPauseBtn" aria-label="播放/暫停">
          <svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          <svg id="pauseIcon" viewBox="0 0 24 24" style="display:none;"><path d="M6 19h4V5H6zm8-14v14h4V5z"/></svg>
        </button>
        <select id="rateSel">
          <option value="0.5">0.5x</option>
          <option value="1" selected>1x</option>
          <option value="1.5">1.5x</option>
          <option value="2">2x</option>
          <option value="2.5">2.5x</option>
        </select>
      </div>
    </div>

    <!-- 切換日曆顯示 -->
    <button id="toggleCalendarBtn">顯示月曆</button>
    <div class="card calendar-container hidden" id="calendarSection">
      <div class="calendar-header">
        <button class="nav-btn" id="prevMonth">&#9664;</button>
        <div id="monthDisplay"></div>
        <button class="nav-btn" id="nextMonth">&#9654;</button>
        <div id="monthStats"></div>
      </div>
      <table class="calendar" id="calendar"></table>
    </div>
  </div>

  <script>
    // 計數邏輯
    let dailyData = JSON.parse(localStorage.getItem('dailyData')||'{}');
    const now=new Date(), todayKey=now.toISOString().slice(0,10);
    let [displayYear, displayMonth] = [now.getFullYear(), now.getMonth()];
    let counter=dailyData[todayKey]?.counter||0, groupCount=dailyData[todayKey]?.groupCount||0;
    const counterBtn=document.getElementById('counterBtn'),
          groupDisplay=document.getElementById('groupDisplay');
    counterBtn.textContent=counter;
    groupDisplay.textContent=`組數: ${groupCount}`;
    function saveDay(key,cnt,grp){ dailyData[key]={counter:cnt,groupCount:grp}; localStorage.setItem('dailyData',JSON.stringify(dailyData)); }
    function updateDaily(){ document.getElementById('dailyDisplay').textContent=`今日：${counter} / 108，組數：${groupCount}`; }
    counterBtn.addEventListener('click',()=>{
      counter++; if(counter>=108){ groupCount++; counter=0; }
      counterBtn.textContent=counter;
      groupDisplay.textContent=`組數: ${groupCount}`;
      saveDay(todayKey,counter,groupCount);
      updateDaily(); renderCalendar();
    });

    // 切換日曆
    const toggleBtn = document.getElementById('toggleCalendarBtn');
    const calendarCard = document.getElementById('calendarSection');
    toggleBtn.addEventListener('click', () => {
      if(calendarCard.classList.toggle('hidden')) toggleBtn.textContent = '顯示月曆';
      else toggleBtn.textContent = '隱藏月曆';
    });

    // 月曆功能
    document.getElementById('prevMonth').onclick=()=>{ displayMonth--; if(displayMonth<0){ displayMonth=11; displayYear--; } renderCalendar(); };
    document.getElementById('nextMonth').onclick=()=>{ displayMonth++; if(displayMonth>11){ displayMonth=0; displayYear++; } renderCalendar(); };
    function renderCalendar(){
      document.getElementById('monthDisplay').textContent=`${displayYear} 年 ${displayMonth+1} 月`;
      const cal=document.getElementById('calendar'); cal.innerHTML='';
      const first=new Date(displayYear,displayMonth,1).getDay(), offset=(first+6)%7;
      const days=new Date(displayYear,displayMonth+1,0).getDate();
      const dow=['一','二','三','四','五','六','日'];
      let html='<tr>'+dow.map(d=>`<th>${d}</th>`).join('')+'</tr><tr>';
      html += '<td></td>'.repeat(offset);
      let total=0;
      for(let d=1; d<=days; d++){
        const key=`${displayYear}-${String(displayMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const data=dailyData[key]||{counter:0,groupCount:0}; total += data.groupCount;
        const cls = key===todayKey?'today':'';
        html+=`<td class="${cls}">${d}<div class="counts">${data.counter}/${data.groupCount}</div></td>`;
        if((offset+d)%7===0 && d<days) html+='</tr><tr>';
      }
      html+='</tr>';
      cal.innerHTML=html;
      document.getElementById('monthStats').textContent=`本月組數: ${total}`;
    }
    renderCalendar(); updateDaily();

    // 背景音樂控制
    const audio=new Audio('background.m4a'); audio.loop=true; audio.preload='auto'; audio.playbackRate=1;
    const playIcon=document.getElementById('playIcon'), pauseIcon=document.getElementById('pauseIcon'), playPauseBtn=document.getElementById('playPauseBtn'), rateSel=document.getElementById('rateSel');

    playPauseBtn.addEventListener('click', ()=>{
      if(audio.paused){ audio.play(); playIcon.style.display='none'; pauseIcon.style.display='block'; }
      else { audio.pause(); playIcon.style.display='block'; pauseIcon.style.display='none'; }
    });
    rateSel.addEventListener('change', ()=> audio.playbackRate=+rateSel.value);
  </script>
</body>
</html>
