<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ë®àÊï∏Âô®</title>
  <style>
    :root {
      --bg: #f2f6f8;
      --primary: #5a90b8;
      --text: #fff;
      --muted: #6a7b8a;
      --card: #ffffff;
      --today: #dcefff;
    }

    * {
      box-sizing: border-box;
    }

    body, html {
      margin: 0;
      padding: 0;
      background: var(--bg);
      font-family: "Helvetica Neue", sans-serif;
    }

    .counter-screen .tap-area {
      height: calc(100vh - 10px);
      margin: 5px;
      border-radius: 24px;
      background: var(--primary);
   color: #dde6ee;

      font-size: 30vw;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      user-select: none;
      transition: background 0.3s;
    }

    .calendar-screen {
      display: none;
      padding: 16px;
      background: var(--card);
      border-top: 2px solid #ccc;
      border-radius: 16px 16px 0 0;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
    }

    .calendar-screen.active {
      display: block;
    }

    .calendar-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
    }

    .calendar-header .month-nav {
      display: flex;
      align-items: center;
      gap: 16px;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .calendar-header .month-nav button {
      font-size: 1.2rem;
      padding: 6px 10px;
      border-radius: 8px;
      background: var(--primary);
      color: white;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 8px;
    }

    .weekday {
      text-align: center;
      font-weight: bold;
      color: var(--muted);
    }

    .day {
      height: 50px;
      background: #f0f0f0;
      border-radius: 10px;
      font-size: 0.8rem;
      text-align: center;
      padding-top: 4px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
    }

    .day .info {
      font-size: 0.7rem;
      color: #999;
    }

    .today {
      background: var(--today);
      font-weight: bold;
      border: 2px solid var(--primary);
    }

    .circle-btn {
      position: fixed;
      top: 10px;
      background: #6b8797;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-size: 1.2rem;
      border: none;
      color: #black;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .toggle-calendar-btn { right: 130px; }
    .reset-btn { right: 180px; }
    .play-btn { right: 10px; }
    .speed-btn { right: 60px; font-size: 0.9rem; }

    .monthly-box {
      display: inline-block;
      margin-top: 6px;
      padding: 4px 10px;
      border-radius: 12px;
      background: #6b8797;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>
  <!-- ÊéßÂà∂ÊåâÈàï -->
  <button class="circle-btn play-btn" onclick="togglePlay()">‚ñ∂</button>
  <button class="circle-btn speed-btn" onclick="toggleSpeed()">1x</button>
  <button class="circle-btn reset-btn">‚ôª</button>
  <button class="circle-btn toggle-calendar-btn" onclick="toggleCalendar()">üßæ</button>

  <!-- Ë®àÊï∏Âô® + ÊúàÊõÜÂçÄÂ°ä -->
  <div id="counterScreen" class="counter-screen">
    <div class="tap-area" id="tapArea">0 / 0</div>
    <div id="calendarScreen" class="calendar-screen">
      <div class="calendar-header">
        <div class="month-nav">
          <button onclick="changeMonth(-1)">‚Üê</button>
          <span id="monthLabel"></span>
          <button onclick="changeMonth(1)">‚Üí</button>
        </div>
      </div>
      <div class="calendar-grid" id="calendarWeekdays"></div>
      <div class="calendar-grid" id="calendarDays"></div>
      <div style="margin-top:8px;font-weight:bold;">Êú¨ÊúàÁµÑÊï∏Ôºö
        <div class="monthly-box"><span id="monthlyTotal">0</span></div>
      </div>
    </div>
  </div>

  <audio id="bgm" loop>
    <source src="background.mp3" type="audio/mpeg">
  </audio>

  <script>
    const countEl = document.getElementById('tapArea');
    const calendarScreen = document.getElementById('calendarScreen');
    const calendarDaysEl = document.getElementById('calendarDays');
    const calendarWeekdaysEl = document.getElementById('calendarWeekdays');
    const monthLabelEl = document.getElementById('monthLabel');
    const monthlyTotalEl = document.getElementById('monthlyTotal');
    const audio = document.getElementById('bgm');
    const speedBtn = document.querySelector('.speed-btn');
    const calendarBtn = document.querySelector('.toggle-calendar-btn');
    const resetBtn = document.querySelector('.reset-btn');

    const today = new Date();
    const todayKey = `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;

    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    let currentSpeed = 1;

    let monthData = JSON.parse(localStorage.getItem('monthData')) || {};
    let count = parseInt(localStorage.getItem('count')) || 0;
    let group = parseInt(localStorage.getItem('group')) || 0;

    function save() {
      localStorage.setItem('count', count);
      localStorage.setItem('group', group);
      monthData[todayKey] = { count, group };
      localStorage.setItem('monthData', JSON.stringify(monthData));
      if (calendarScreen.classList.contains('active')) {
        renderCalendar(currentYear, currentMonth);
      }
    }

    function updateCounterDisplay() {
      countEl.textContent = `${count} / ${group}`;
    }

    function incrementCounter() {
      count++;
      if (count >= 108) {
        count = 0;
        group++;
      }
      updateCounterDisplay();
      save();
    }

    let pressTimer;
    countEl.addEventListener('mousedown', () => {
      pressTimer = setTimeout(() => {
        group = 0;
        count = 0;
        updateCounterDisplay();
        save();
      }, 2000);
    });

    countEl.addEventListener('mouseup', () => {
      clearTimeout(pressTimer);
    });

    countEl.addEventListener('click', () => {
      incrementCounter();
    });

    let lastResetClick = 0;
    resetBtn.addEventListener('click', () => {
      const now = Date.now();
      if (now - lastResetClick < 500) {
        resetData();
      }
      lastResetClick = now;
    });

    function toggleCalendar() {
      const visible = calendarScreen.classList.toggle('active');
      calendarBtn.textContent = visible ? '‚¨Ö' : 'üìÖ';
      if (visible) renderCalendar(currentYear, currentMonth);
    }

    function getDaysInMonth(year, month) {
      return new Date(year, month + 1, 0).getDate();
    }

    function renderCalendar(year, month) {
      calendarDaysEl.innerHTML = '';
      calendarWeekdaysEl.innerHTML = '';
      const weekdays = ['‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'];
      weekdays.forEach(day => {
        const el = document.createElement('div');
        el.className = 'weekday';
        el.textContent = day;
        calendarWeekdaysEl.appendChild(el);
      });

      const days = getDaysInMonth(year, month);
      const firstDay = new Date(year, month, 1).getDay();
      const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
      let monthlyTotal = 0;
      for (let i = 0; i < adjustedFirstDay; i++) {
        calendarDaysEl.appendChild(document.createElement('div'));
      }
      for (let i = 1; i <= days; i++) {
        const key = `${year}-${month + 1}-${i}`;
        const d = document.createElement('div');
        d.className = 'day';
        if (key === todayKey) d.classList.add('today');
        const data = monthData[key] || { count: 0, group: 0 };
        d.innerHTML = `${i}<div class="info">${data.count}/${data.group}</div>`;
        calendarDaysEl.appendChild(d);
        monthlyTotal += data.group;
      }
      monthLabelEl.textContent = `${year} Âπ¥ ${month + 1} Êúà`;
      monthlyTotalEl.textContent = monthlyTotal;
    }

    function changeMonth(offset) {
      currentMonth += offset;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar(currentYear, currentMonth);
    }

    function resetData() {
      group = 0;
      count = 0;
      updateCounterDisplay();
      save();
    }

    function togglePlay() {
      if (audio.paused) {
        audio.play();
        document.querySelector('.play-btn').textContent = '‚ùö‚ùö';
      } else {
        audio.pause();
        document.querySelector('.play-btn').textContent = '‚ñ∂';
      }
    }

    function toggleSpeed() {
      if (currentSpeed === 1) {
        currentSpeed = 1.5;
      } else if (currentSpeed === 1.5) {
        currentSpeed = 2;
      } else {
        currentSpeed = 1;
      }
      audio.playbackRate = currentSpeed;
      speedBtn.textContent = currentSpeed + 'x';
    }

    updateCounterDisplay();
  </script>
</body>
</html>
